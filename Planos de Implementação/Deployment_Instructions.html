<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Atualização do Servidor de Produção</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        h1,
        h2,
        h3 {
            color: #2c3e50;
        }

        code {
            background-color: #f4f4f4;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
        }

        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .critical {
            color: #721c24;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <h1>Guia de Atualização do Servidor de Produção</h1>

    <p>Este guia descreve os passos para atualizar o site no servidor oficial sem perder dados.</p>

    <div class="warning">
        <h2>⚠️ Aviso Crítico: Prevenção de Perda de Dados</h2>
        <p>O banco de dados padrão é um arquivo chamado <code>db.sqlite3</code> na raiz do projeto.</p>
        <p class="critical">NUNCA substitua o arquivo <code>db.sqlite3</code> do servidor pelo arquivo do seu computador
            local.</p>
        <p>Se você fizer isso, <strong>TODOS</strong> os dados de produção (jogadores, partidas, resultados) serão
            substituídos pelos dados de teste do seu computador.</p>
        <p>Da mesma forma, evite substituir a pasta <code>media/</code> se houver uploads de arquivos locais.</p>
    </div>

    <h2>Passo a Passo para Atualização</h2>

    <h3>1. Backup (Sempre faça isso antes!)</h3>
    <p>Antes de mexer em qualquer coisa, faça uma cópia de segurança dos arquivos vitais no servidor:</p>
    <ul>
        <li>Copie o arquivo <code>db.sqlite3</code> para uma pasta segura (ex: <code>backup_antes_update/</code>).</li>
        <li>Copie o arquivo <code>.env</code> (onde ficam as senhas).</li>
        <li>Copie a pasta <code>media/</code> (se existir).</li>
    </ul>

    <h3>2. Transferência de Arquivos</h3>
    <p>Você precisa enviar os arquivos de código modificados para o servidor.</p>

    <p><strong>Método recomendado (Git):</strong></p>
    <p>Se o servidor usa Git:</p>
    <pre><code>git pull origin master</code></pre>

    <p><strong>Método manual (FTP/SFTP):</strong></p>
    <p>Envie <strong>apenas</strong> as pastas e arquivos de código que foram alterados:</p>
    <ul>
        <li><code>obd/core/templates/</code> (Templates alterados)</li>
        <li><code>obd/core/views.py</code></li>
        <li><code>obd/dashboards/administrators/results/</code> (Views, Forms, Urls)</li>
        <li><code>obd/core/static/</code> (Novos ícones)</li>
    </ul>

    <p><strong>NÃO envie:</strong></p>
    <ul>
        <li>❌ <code>db.sqlite3</code></li>
        <li>❌ <code>.env</code></li>
        <li>❌ Pasta <code>media/</code></li>
    </ul>

    <h3>3. Atualizar Dependências (Opcional)</h3>
    <p>Como não adicionamos novas bibliotecas, este passo provavelmente não é necessário, mas é bom garantir:</p>
    <pre><code>pip install -r requirements.txt</code></pre>

    <h3>4. Arquivos Estáticos</h3>
    <p>Como adicionamos novos ícones (o alvo de dardo), você <strong>PRECISA</strong> rodar este comando no servidor
        para que eles apareçam:</p>
    <pre><code>python manage.py collectstatic</code></pre>
    <p>Responda "yes" se ele perguntar para sobrescrever.</p>

    <h3>5. Migrações do Banco de Dados</h3>
    <p>Como removemos campos obsoletos, é bom garantir que o banco de dados esteja sincronizado:</p>
    <pre><code>python manage.py migrate</code></pre>

    <h3>6. Reiniciar o Servidor</h3>
    <p>Para que as alterações no código Python (<code>views.py</code>, etc.) tenham efeito, você precisa reiniciar o
        processo do servidor web.</p>
    <p>Dependendo de como está hospedado (Apache, Nginx, Gunicorn), o comando varia. Exemplos comuns:</p>
    <ul>
        <li><code>sudo systemctl restart gunicorn</code></li>
        <li><code>sudo systemctl restart apache2</code></li>
        <li>Ou se estiver rodando manualmente: <code>CTRL+C</code> e <code>python manage.py runserver</code> (não
            recomendado para produção).</li>
    </ul>

    <h2>Resumo do que foi alterado nesta atualização</h2>
    <ul>
        <li><strong>Templates</strong>: Correção do calendário, remoção de campos de perfil, atualização do link do
            WhatsApp, simplificação do registro de resultados.</li>
        <li><strong>Backend</strong>: Lógica de eventos multidias corrigida, remoção de validação manual/NAKKA.</li>
        <li><strong>Estáticos</strong>: Novo ícone de dardo.</li>
    </ul>

</body>

</html>