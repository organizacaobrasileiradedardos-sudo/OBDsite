{% extends 'base.html' %}
{% load static %}
{% block csslib %}
{% endblock %}
{% block title %}Página Inicial | OBD - Organização Brasileira de Dardos{% endblock %}
{% block styles %}
{% endblock %}
{% block content %}

<div class="container fade-in">
    <div class="row justify-content-center">
        <div class="col-lg-10">

            <!-- Hero Banner -->
            <div class="mb-4 text-center">
                <img src="{% static '/media/logos/1230x200-banner-fundo-escuro.jpg' %}"
                    class="img-fluid rounded shadow-lg" alt="OBD Banner">
            </div>

            <!-- Welcome Card -->
            <div class="card card-dartboard text-center mb-5">
                <div class="card-header card-header-dartboard">
                    <i class="bi bi-bullseye"></i> Bem-vindo ao Portal OBD
                </div>
                <div class="card-body py-5">
                    <h2 class="card-title mb-3 fw-bold">Organização Brasileira de Dardos</h2>
                    <p class="card-text lead text-muted mb-4">Sua liga online de dardos. Venha se divertir conosco!</p>
                    <div class="d-flex justify-content-center gap-3 flex-wrap">
                        <a href="{% url 'players:login' %}" class="btn btn-dartboard-secondary btn-lg"><i
                                class="bi bi-box-arrow-in-right"></i> Login</a>
                        <a href="/subscribe/" class="btn btn-dartboard-primary btn-lg"><i
                                class="bi bi-pencil-square"></i>
                            Cadastrar-se</a>
                        <a href="https://forms.gle/ke92g2pztnd4Jk99A" class="btn btn-dartboard-outline btn-lg"
                            target="_blank"><i class="bi bi-bug"></i> Reportar</a>
                    </div>
                </div>
                <div class="card-footer card-footer-dartboard text-muted small">
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <span>Versão 1.0 | Status: <span class="text-dartboard-green fw-bold">Online</span> <span
                                class="spinner-grow spinner-grow-sm text-success" role="status"></span></span>
                        <span>
                            <a href="/updates/" class="text-decoration-none me-3">Atualizações</a>
                            <a href="https://scoutapm.com/shares/0c8dd79b-283a-458b-b399-39d0476b1329" target="_blank"
                                class="text-decoration-none">Status do Servidor</a>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="row g-4 mb-5">
                <!-- Recent Games -->
                <div class="col-lg-8">
                    <div class="card card-dartboard h-100">
                        <div class="card-header card-header-dartboard green">
                            <i class="bi bi-clock-history"></i> Jogos Recentes
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover mb-0 align-middle">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Ver</th>
                                        <th class="text-end">Jogador 1</th>
                                        <th class="text-center">Placar</th>
                                        <th>Jogador 2</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for match in matches %}
                                    <tr>
                                        <td>{{ match.on_date | date:"d/m/Y"}}</td>
                                        <td><a href="{% url 'result' slug=match.division.slug match=match.id %}"
                                                class="btn btn-sm btn-outline-primary"><i class="bi bi-search"></i></a>
                                        </td>
                                        <td class="text-end">
                                            {% if match.result_set.first.player.profile.pin and match.result_set.first.player.first_name and match.result_set.first.player.last_name %}
                                            <a
                                                href="{% url 'profiles:publicprofile' pin=match.result_set.first.player.profile.pin first=match.result_set.first.player.first_name last=match.result_set.first.player.last_name %}">{{
                                                match.result_set.first.player.first_name }} {{
                                                match.result_set.first.player.last_name }}</a>
                                            {% else %}
                                            {{ match.result_set.first.player.first_name }} {{
                                            match.result_set.first.player.last_name }}
                                            {% endif %}
                                        </td>
                                        <td class="text-center fw-bold text-white">{{ match.result_set.first.legs }} x
                                            {{ match.result_set.last.legs }}</td>
                                        <td>
                                            {% if match.result_set.last.player.profile.pin and match.result_set.last.player.first_name and match.result_set.last.player.last_name %}
                                            <a
                                                href="{% url 'profiles:publicprofile' pin=match.result_set.last.player.profile.pin first=match.result_set.last.player.first_name last=match.result_set.last.player.last_name %}">{{
                                                match.result_set.last.player.first_name }} {{
                                                match.result_set.last.player.last_name }}</a>
                                            {% else %}
                                            {{ match.result_set.last.player.first_name }} {{
                                            match.result_set.last.player.last_name }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="5" class="text-center py-4">Nenhum jogo recente.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sponsors Carousel -->
                <div class="col-lg-4">
                    <div class="card card-dartboard h-100">
                        <div class="card-header card-header-dartboard gold">
                            <i class="bi bi-star"></i> Apoiadores
                        </div>
                        <div class="card-body p-0 d-flex align-items-center bg-white rounded-bottom">
                            <div id="sponsorsCarousel" class="carousel slide w-100" data-bs-ride="carousel">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <a href="https://www.petraagregados.com/" target="_blank">
                                            <img src="{% static '/media/sponsors/petra.png' %}" class="d-block w-100"
                                                style="height: 300px; object-fit: contain;" alt="Petra">
                                        </a>
                                    </div>
                                    <div class="carousel-item">
                                        <a href="https://ongclubeup.org/" target="_blank">
                                            <img src="{% static '/media/sponsors/clube_up.png' %}" class="d-block w-100"
                                                style="height: 300px; object-fit: contain;" alt="Clube Up">
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Player Stats -->
            <div class="mb-5">
                <h3 class="text-center mb-4 fw-bold"><i class="bi bi-person-lines-fill text-dartboard-red"></i>
                    Estatísticas
                    dos Jogadores</h3>
                <div class="row g-4">
                    <!-- Best Averages -->
                    <div class="col-md-4">
                        <div class="card card-dartboard h-100">
                            <div
                                class="card-header card-header-dartboard d-flex justify-content-between align-items-center">
                                <span>Melhores Médias</span> <i class="bi bi-award"></i>
                            </div>
                            <ul class="list-group list-group-flush">
                                {% for line in stats_avg %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {% if line.user.profile.pin and line.user.first_name and line.user.last_name %}
                                    <a
                                        href="{% url 'profiles:publicprofile' pin=line.user.profile.pin first=line.user.first_name last=line.user.last_name %}">
                                        <span class="fw-bold text-muted me-2">{{ forloop.counter }}º</span>
                                        {{ line.user.first_name }} {{ line.user.last_name }}
                                    </a>
                                    {% else %}
                                    <span>
                                        <span class="fw-bold text-muted me-2">{{ forloop.counter }}º</span>
                                        {{ line.user.first_name }} {{ line.user.last_name }}
                                    </span>
                                    {% endif %}
                                    <span class="badge badge-dartboard badge-red rounded-pill">{{ line.bcmAvg |
                                        floatformat:"2"}}</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>

                    <!-- Best Checkouts -->
                    <div class="col-md-4">
                        <div class="card card-dartboard h-100">
                            <div
                                class="card-header card-header-dartboard green d-flex justify-content-between align-items-center">
                                <span>Melhores Fechadas</span> <i class="bi bi-calculator"></i>
                            </div>
                            <ul class="list-group list-group-flush">
                                {% for line in stats_out %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {% if line.user.profile.pin and line.user.first_name and line.user.last_name %}
                                    <a
                                        href="{% url 'profiles:publicprofile' pin=line.user.profile.pin first=line.user.first_name last=line.user.last_name %}">
                                        <span class="fw-bold text-muted me-2">{{ forloop.counter }}º</span>
                                        {{ line.user.first_name }} {{ line.user.last_name }}
                                    </a>
                                    {% else %}
                                    <span>
                                        <span class="fw-bold text-muted me-2">{{ forloop.counter }}º</span>
                                        {{ line.user.first_name }} {{ line.user.last_name }}
                                    </span>
                                    {% endif %}
                                    <span class="badge badge-dartboard badge-green rounded-pill">{{ line.bcmOut
                                        }}</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>

                    <!-- Top 180s -->
                    <div class="col-md-4">
                        <div class="card card-dartboard h-100">
                            <div
                                class="card-header card-header-dartboard d-flex justify-content-between align-items-center">
                                <span>Top 180s</span> <i class="bi bi-lightning-charge-fill"></i>
                            </div>
                            <ul class="list-group list-group-flush">
                                {% for line in stats_180 %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {% if line.user.profile.pin and line.user.first_name and line.user.last_name %}
                                    <a
                                        href="{% url 'profiles:publicprofile' pin=line.user.profile.pin first=line.user.first_name last=line.user.last_name %}">
                                        <span class="fw-bold text-muted me-2">{{ forloop.counter }}º</span>
                                        {{ line.user.first_name }} {{ line.user.last_name }}
                                    </a>
                                    {% else %}
                                    <span>
                                        <span class="fw-bold text-muted me-2">{{ forloop.counter }}º</span>
                                        {{ line.user.first_name }} {{ line.user.last_name }}
                                    </span>
                                    {% endif %}
                                    <span class="badge badge-dartboard badge-gold rounded-pill">{{ line.bcmTon80
                                        }}</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- OBD Stats -->
            <div class="mb-5">
                <h3 class="text-center mb-4 fw-bold"><i class="bi bi-graph-up text-accent"></i> Estatísticas OBD</h3>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-white">Dados Gerais</div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">Média
                                    Geral <span class="badge bg-primary rounded-pill">{% if boa.average %}{{ boa.average
                                        | floatformat:"2" }}{% else %}0{% endif %}</span></li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">Partidas
                                    <span class="badge bg-primary rounded-pill">{{ games|default:"0" }}</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">Legs <span
                                        class="badge bg-primary rounded-pill">{{ boa.legs|default:"0" }}</span></li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">Jogadores
                                    <span class="badge bg-primary rounded-pill">{{ members|default:"0" }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-white">Scores</div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">100+ <span
                                        class="badge bg-primary rounded-pill">{{ boa.ton|default:"0" }}</span></li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">140+ <span
                                        class="badge bg-primary rounded-pill">{{ boa.ton40|default:"0" }}</span></li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">170+ <span
                                        class="badge bg-primary rounded-pill">{{ boa.ton70|default:"0" }}</span></li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">180s <span
                                        class="badge bg-danger rounded-pill">{{ boa.ton80|default:"0" }}</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-white">Servidores</div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Webcamdarts <span class="badge bg-primary rounded-pill">{{ server.webcamdarts
                                        }}</span></li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">Nakka
                                    <span class="badge bg-primary rounded-pill">{{ server.nakka }}</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">Manual
                                    <span class="badge bg-primary rounded-pill">{{ server.manual }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- League Summary -->
            <div class="mb-5">
                <h3 class="text-center mb-4 fw-bold"><i class="bi bi-trophy text-accent"></i> Resumo das Ligas</h3>
                <div class="table-responsive">
                    <table
                        class="table table-dark table-striped table-hover text-center align-middle rounded overflow-hidden">
                        <thead>
                            <tr>
                                <th>Total</th>
                                <th>Inscrição</th>
                                <th>Formação</th>
                                <th>Andamento</th>
                                <th>Playoffs</th>
                                <th>Finais</th>
                                <th>Encerradas</th>
                                <th>Anuladas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th class="fs-4">{{ total }}</th>
                                <td>{{ opens }}</td>
                                <td>{{ formations }}</td>
                                <td>{{ starts}}</td>
                                <td>{{ playoffs }}</td>
                                <td>{{ finals }}</td>
                                <td>{{ ends }}</td>
                                <td>{{ canceled }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Videos -->
            <div class="row g-4 mb-5">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-danger text-white"><i class="bi bi-youtube"></i> OBD TV</div>
                        <div class="card-body p-0">
                            <div class="ratio ratio-16x9">
                                <iframe src="https://www.youtube.com/embed/JNej-H_dYjw" title="OBD TV"
                                    allowfullscreen></iframe>
                            </div>
                        </div>
                        <div class="card-footer text-center">
                            <a href="https://youtube.com/channel/UCfuq0wQ2xzUnv3S75iN4vNg" target="_blank"
                                class="btn btn-sm btn-danger">Inscrever-se</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-danger text-white"><i class="bi bi-youtube"></i> Diogo Portela TV
                        </div>
                        <div class="card-body p-0">
                            <div class="ratio ratio-16x9">
                                <iframe src="https://www.youtube.com/embed/3iw_-KbZB-k" title="Diogo Portela TV"
                                    allowfullscreen></iframe>
                            </div>
                        </div>
                        <div class="card-footer text-center">
                            <a href="https://www.youtube.com/channel/UC6spzS1PJkv9rw9UfyZTpGg" target="_blank"
                                class="btn btn-sm btn-danger">Inscrever-se</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

{% endblock %}
{% block jslib %}
{% endblock %}