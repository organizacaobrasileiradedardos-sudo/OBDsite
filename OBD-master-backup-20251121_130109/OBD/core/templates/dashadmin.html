{% extends 'baseadmin.html' %}
{% block csslib %}
{% endblock %}
{% block title %} Página de Administração do OBD: Principal {% endblock %}
{% block styles %}
{% endblock %}
{% block page %}Principal Dashboard OBD{% endblock %}
{% block boauser %} Administrador {% endblock %}
{% block content %}

{% if messages %}
{% for message in messages %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
  <a href="#" class="link-success">{{ message}}</a>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
{% endif %}

{% if form.errors %}
{% for field in form %}
{% for error in field.errors %}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
  <strong>{{ error|escape }}</strong>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
{% endfor %}
{% for error in form.non_field_errors %}
<div class="alert alert-danger">
  <strong>{{ error|escape }}</strong>
</div>
{% endfor %}
{% endif %}

<h5><strong><i class="bi bi-award-fill"></i> Sumário Geral das Ligas OBD</strong></h5>
<p></p>
<table class="table table-sm table-dark">
  <thead>
    <tr>
      <th scope="col">Total de Ligas</th>
      <th scope="col">Inscrição</th>
      <th scope="col">Formação</th>
      <th scope="col">Andamento</th>
      <th scope="col">Playoffs</th>
      <th scope="col">Finais</th>
      <th scope="col">Encerradas</th>
      <th scope="col">Encerradas</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">{{ total }}</th>
      <td>{{ opens.count }}</td>
      <td>{{ formations.count }}</td>
      <td>{{ starts.count }}</td>
      <td>{{ playoffs.count }}</td>
      <td>{{ finals.count }}</td>
      <td>{{ ends.count }}</td>
      <td>{{ canceled.count }}</td>
    </tr>
  </tbody>
</table>

<p><br></p>

<h5><strong><i class="bi bi-arrow-repeat"></i> Ligas em Andamento</strong></h5>
<p></p>
<table class="table table-sm table-dark">
  <thead>
    <tr>
      <th scope="col" style="text-align: center; vertical-align: middle;">Liga</th>
      <th scope="col" style="text-align: center; vertical-align: middle;">Descrição</th>
      <th scope="col" style="text-align: center; vertical-align: middle;">Fase</th>
      <th scope="col" style="text-align: center; vertical-align: middle;">Escopo</th>
      <th scope="col" style="text-align: center; vertical-align: middle;">Divisões</th>
      <th scope="col" style="text-align: center; vertical-align: middle;">Criado em</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      {% for league in starts %}
      <th scope="row" style="text-align: center; vertical-align: middle;">{{ league.name }} #{{ league.id }}</th>
      <td style="text-align: center; vertical-align: middle;">{{ league.description }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.get_phase_display }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.get_scope_display }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.division_set.count }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.created_at |date:"d/M/y" }}</td>
    </tr>
    {% endfor %}
    <tr>
      {% for league in playoffs %}
      <th scope="row" style="text-align: center; vertical-align: middle;">{{ league.name }} #{{ league.id }}</th>
      <td style="text-align: center; vertical-align: middle;">{{ league.description }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.get_phase_display }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.get_scope_display }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.division_set.count }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.created_at |date:"d/M/Y" }}</td>
    </tr>
    {% endfor %}
    <tr>
      {% for league in finals %}
      <th scope="row" style="text-align: center; vertical-align: middle;">{{ league.name }} #{{ league.id }}</th>
      <td style="text-align: center; vertical-align: middle;">{{ league.description }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.get_phase_display }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.get_scope_display }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.division_set.count }}</td>
      <td style="text-align: center; vertical-align: middle;">{{ league.created_at }}</td>
    </tr>
    {% endfor %}

  </tbody>
</table>

<p><br></p>


<h5><strong><i class="bi bi-hourglass-bottom"></i> Jogos pendentes (Validação)</strong></h5>
<p></p>

{% if pending %}
<table class="table">
  <thead>
    <tr>
      <th scope="col">ID Partida</th>
      <th scope="col"></th>
      <th></th>
      <th></th>
      <th></th>
      <th scope="col"></th>
      <th scope="col">Finalizado?</th>
      <th scope="col">Validação?</th>
      <th scope="col">Ação?</th>
    </tr>
  </thead>
  <tbody>
    {% for match in pending %}
    <tr>
      <td>{{ match.id }}</td>
      <td>{{ match.on_date }}</td>
      <td><strong>{{ match.result_set.first.player.first_name }} {{ match.result_set.first.player.last_name }}</strong>
        <h6 style="font-size: smaller">({{ match.result_set.first.player.username }})</h6>
      </td>
      <td><span class="badge bg-warning text-dark">{% if match.result_set.first.legs is None %} 0 {% else %} {{
          match.result_set.first.legs }}{% endif %} </span></td>
      <td><strong>Vs.</strong></td>
      <td><span class="badge bg-warning text-dark">{% if match.result_set.last.legs is None %} 0 {% else %} {{
          match.result_set.last.legs }} {% endif %}</span></td>
      <td><strong>{{ match.result_set.last.player.first_name }} {{ match.result_set.last.player.last_name }}</strong>
        <h6 style="font-size: smaller">({{ match.result_set.last.player.username }})</h6>
      </td>
      <td>{{ match.get_status_display.capitalize }}</td>
      <td>{{ match.get_validation_display.capitalize }}</td>
      <td>

        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2"
            data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-shield-exclamation"></i> Ações Disponíveis
          </button>
          <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="dropdownMenuButton2">
            <li><a class="dropdown-item" href="{{ match.photo }}" target="_blank"><i class="bi bi-zoom-in"></i> Ver
                anexo</a></li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#game{{match.id}}"><i
                  class="bi bi-hand-thumbs-up"></i> Validar Partida</a></li>
          </ul>
        </div>

      </td>
    </tr>

    <!-- Modal -->
    <div class="modal fade" id="game{{match.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel" style="font-size: medium">{{ match.division.name | upper }} -
              Partida <strong>#{{ match.id }}</strong></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body modal-lg">

            <div class="container-fluid">
              <div class="row">
                <div class="col-sm-4"><strong></strong></div>
                <div class="col justify-content-md-center">{{ match.result_set.first.player.first_name }}</div>
                <div class="col justify-content-md-center">{{ match.result_set.last.player.first_name }}</div>
              </div>

              <div class="row">
                <div class="col-sm-4"></div>
                <div class="col justify-content-md-center">{{ match.result_set.first.player.last_name }}</div>
                <div class="col justify-content-md-center">{{ match.result_set.last.player.last_name }}</div>
              </div>

              <hr>

              <div class="row">
                <div class="col-sm">Sets</div>
                <div class="col-sm">{{ match.result_set.first.sets }}</div>
                <div class="col-sm">{{ match.result_set.last.sets }}</div>
              </div>

              <div class="row">
                <div class="col-sm">Legs</div>
                <div class="col-sm">{{ match.result_set.first.legs }}</div>
                <div class="col-sm">{{ match.result_set.last.legs }}</div>
              </div>

              <div class="row">
                <div class="col-sm">Média</div>
                <div class="col-sm">{{ match.result_set.first.average }}</div>
                <div class="col-sm">{{ match.result_set.last.average | floatformat:"2"}}</div>
              </div>

              <div class="row">
                <div class="col-sm">Melhor Fechada</div>
                <div class="col-sm">{{ match.result_set.first.highest_out }}</div>
                <div class="col-sm">{{ match.result_set.last.highest_out }}</div>
              </div>

              <div class="row">
                <div class="col-sm">Melhor Leg</div>
                <div class="col-sm">{{ match.result_set.first.best_leg }}</div>
                <div class="col-sm">{{ match.result_set.last.best_leg }}</div>
              </div>

              <div class="row">
                <div class="col-sm">100+</div>
                <div class="col-sm">{{ match.result_set.first.ton }}</div>
                <div class="col-sm">{{ match.result_set.last.ton }}</div>
              </div>

              <div class="row">
                <div class="col-sm">140+</div>
                <div class="col-sm">{{ match.result_set.first.ton40 }}</div>
                <div class="col-sm">{{ match.result_set.last.ton40 }}</div>
              </div>

              <div class="row">
                <div class="col-sm">170+</div>
                <div class="col-sm">{{ match.result_set.first.ton70 }}</div>
                <div class="col-sm">{{ match.result_set.last.ton70 }}</div>
              </div>

              <div class="row">
                <div class="col-sm">180+</div>
                <div class="col-sm">{{ match.result_set.first.ton80 }}</div>
                <div class="col-sm">{{ match.result_set.last.ton80 }}</div>
              </div>
              <hr>
              <p align="center"><strong>OBD</strong> | Resultado #{{ match.id }} acessado em {% now "d/m/Y" %}</p>
              <p align="center">www.brasilonlineassociacao.com.br</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>

              {% if match.validation == 0 %}
              {% if match.submited_by != user.username %}
              <a class="btn btn-warning" href="{% url 'results:invalidate' match=match.id %}"
                role="button">Invalidar</a>
              <a class="btn btn-success" href="{% url 'results:validate' match=match.id %}" role="button">Confirmar</a>

              {% endif %}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    {% endfor %}
  </tbody>
</table>
<p><br></p>
{% else %}
<p>Fala aí, {{ user.first_name }} {{ user.last_name }}! Não há jojogos pendentes de validação no momento.</p>
{% endif %}
<p><br></p>


{% endblock %}
{% block jslib %}
{% endblock %}